# Implementation Notes

Longer-term notes can be found in `/notes/*.md`. This file is ephemeral
and will be reset periodically, so it's meant to capture more immediate
insights, issues, and learnings during the implementation process.

Add new items below this line

---

## Outbox Delivery Gap

`vultron/api/v2/data/actor_io.py` has a placeholder that appends strings to an
outbox list but does not write to any recipient actor's inbox. No delivery
mechanism exists. This means outbox-based activities (e.g., CreateCase
activity generated by `create_case` handler) are never actually received by
other actors. This is acceptable for the prototype demos (which sequence
activities manually) but must be resolved before the `CaseActor` broadcast
model (Priority 200) can work correctly.

## CM-03-006 Rename Risk

`VulnerabilityCase.case_status` (list field with singular name) is referenced
throughout `handlers.py` (~20 call sites), `behaviors/`, and many tests.
The rename to `case_statuses` is a correctness improvement per the spec but
carries significant breakage risk. Run `grep -rn "\.case_status" vultron/ test/`
before starting to quantify scope. Consider doing `case_statuses` and
`participant_statuses` renames in the same PR to keep the diff localized.

## DEMO-4 Isolation Complexity

When running multiple demos in sequence (via the `all` sub-command), each demo
must leave the DataLayer in a clean state. The current demo scripts were each
designed to run against a clean slate. Key risks:

- Demos that create actors with fixed IDs (e.g., `vendor`, `finder`) will
  conflict on second run unless teardown deletes those actors.
- The `manage_case_demo` and `manage_embargo_demo` share similar object types;
  ensure teardown is comprehensive.
- Teardown should use the DataLayer directly (not via HTTP inbox) to guarantee
  cleanup even when the demo fails mid-way.

Consider designing teardown as a `finally` block that iterates all DataLayer
entries created during the demo and deletes them by ID.

## DEMO-4 Docker Interaction Mode

The unified demo container should be interactive by default (`docker compose
run demo` or `docker compose up demo` with TTY). The `DEMO` env var override
(`DEMO=receive-report docker compose up demo`) is the non-interactive path for
CI or scripted runs. Verify that click's interactive prompts degrade gracefully
when stdin is not a TTY (use `click.echo` + non-interactive fallback if needed).
