# Implementation Notes

Longer-term notes can be found in `/notes/*.md`. This file is ephemeral
and will be reset periodically, so it's meant to capture more immediate
insights, issues, and learnings during the implementation process.

Add new items below this line

---

> **Note**: The "Decoupling Case Domain Model from ActivityStreams Wire Format"
> architectural insight that was previously in this file has been promoted to
> `notes/domain-model-separation.md` as a durable design note.

---

## 2026-02-24 — Gap Analysis Notes (refresh #6)

### Missing MessageSemantics (BT-8)

Three activity types are in `vultron/as_vocab/` and referenced by vocab_examples
but have no `MessageSemantics` entry, no `ActivityPattern`, and no handler:

1. **`RmReEngageCase`** (`as:Undo` of `RmDeferCase`) — used in `manage_case.md`
   and has a `reengage_case()` factory in `vocab_examples.py` that returns a raw
   `as_Undo`. A named `RmReEngageCase(as_Undo)` class does not yet exist in
   `vultron/as_vocab/activities/case.py`. Semantics: undo deferral → transition
   actor's `ParticipantStatus.rm_state` back to ACCEPTED.

2. **`UpdateCase`** (`as:Update(VulnerabilityCase)`) — class exists in
   `vultron/as_vocab/activities/case.py` but is not wired into the handler
   pipeline at all.

3. **`ChoosePreferredEmbargo`** (`as:Question`) — class exists in
   `vultron/as_vocab/activities/embargo.py` but not wired in.

All three must be added before `manage_case_demo.py` and `manage_embargo_demo.py`
can cover their full documented workflows.

### CM-03-006 Rename Risk

`VulnerabilityCase.case_status` (list field with singular name) is referenced
throughout `handlers.py` (~20 call sites), `behaviors/`, and many tests.
The rename to `case_statuses` is a correctness improvement per the spec but
carries significant breakage risk. Run `grep -rn "\.case_status" vultron/ test/`
before starting to quantify scope. Consider doing `case_statuses` and
`participant_statuses` renames in the same PR to keep the diff localized.

### Outbox Delivery Gap

`vultron/api/v2/data/actor_io.py` has a placeholder that appends strings to an
outbox list but does not write to any recipient actor's inbox. No delivery
mechanism exists. This means outbox-based activities (e.g., CreateCase
activity generated by `create_case` handler) are never actually received by
other actors. This is acceptable for the prototype demos (which sequence
activities manually) but must be resolved before the CaseActor broadcast
model (Priority 200) can work correctly.

### Demo Script Gap Summary

Per `plan/PRIORITIES.md`, the following howto workflows still need demo scripts:

- **Higher priority**: `acknowledge.md`, `manage_case.md`,
  `initialize_participant.md`, `manage_embargo.md`, `manage_participants.md`
- **Lower priority**: `error.md`

Note: `manage_case_demo.py` depends on BT-8 (REENGAGE_CASE handler) for a
complete workflow. The demo can be written without it by skipping the reengage
step, but adding REENGAGE_CASE first is cleaner.
