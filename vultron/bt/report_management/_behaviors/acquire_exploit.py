#!/usr/bin/env python
"""file: acquire_exploit
author: adh
created_at: 6/23/22 2:44 PM
"""
#  Copyright (c) 2023 Carnegie Mellon University and Contributors.
#  - see Contributors.md for a full list of Contributors
#  - see ContributionInstructions.md for information on how you can Contribute to this project
#  Vultron Multiparty Coordinated Vulnerability Disclosure Protocol Prototype is
#  licensed under a MIT (SEI)-style license, please see LICENSE.md distributed
#  with this Software or contact permission@sei.cmu.edu for full terms.
#  Created, in part, with funding and support from the United States Government
#  (see Acknowledgments file). This program may include and/or can make use of
#  certain third party source code, object code, documentation and other files
#  (“Third Party Software”). See LICENSE.md for more details.
#  Carnegie Mellon®, CERT® and CERT Coordination Center® are registered in the
#  U.S. Patent and Trademark Office by Carnegie Mellon University


from vultron.bt.base.composites import FallbackNode, SequenceNode
from vultron.bt.report_management.fuzzer.acquire_exploit import (
    DevelopExploit,
    EvaluateExploitPriority,
    ExploitDeferred,
    ExploitDesired,
    ExploitPrioritySet,
    FindExploit,
    HaveExploit,
    PurchaseExploit,
)


class EnsureExploitPriorityIsSet(FallbackNode):
    """This node ensures that the exploit priority is set."""

    _children = (ExploitPrioritySet, EvaluateExploitPriority)


class AttemptExploitAcquisition(FallbackNode):
    """This node attempts to acquire the exploit.
    Steps:
    1. Attempt to find the exploit in the wild
    2. Attempt to develop the exploit in-house
    3. Attempt to purchase the exploit from someone else
    If any of these steps succeed, the exploit is acquired.
    If all of these steps fail, the exploit is not acquired.
    """

    _children = (FindExploit, DevelopExploit, PurchaseExploit)


class AcquireExploitIfDesired(SequenceNode):
    """This node attempts to acquire the exploit if it is desired.
    Steps:
    1. Ensure that the exploit priority is set
    2. Ensure that the exploit is desired
    3. Attempt to acquire the exploit
    If all of these steps succeed, the exploit is acquired.
    If any of these steps fail, the exploit is not acquired.
    """

    _children = (
        EnsureExploitPriorityIsSet,
        ExploitDesired,
        AttemptExploitAcquisition,
    )


class AcquireExploit(FallbackNode):
    """This node attempts to acquire the exploit.
    Steps:
    1. Check whether the exploit is already acquired
    2. Attempt to acquire the exploit if it is desired
    3. If the exploit is not acquired, decide whether to defer the acquisition attempt
    If any of these steps succeed, the node succeeds.
    If all of these steps fail, the node fails.
    """

    _children = (HaveExploit, AcquireExploitIfDesired, ExploitDeferred)
